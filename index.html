<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRIDUC MEDIA | Monitor System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.0/hls.min.js"></script>
    <style>
        body { 
            background: #000; margin: 0; color: #fff; 
            font-family: 'Segoe UI', sans-serif; 
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }
        
        /* Header */
        header { 
            padding: 5px 15px; background: #1a1a1a; 
            display: flex; gap: 10px; border-bottom: 2px solid #00ff88; 
            align-items: center; justify-content: space-between; height: 40px;
        }
        
        .brand { font-weight: bold; color: #00ff88; text-transform: uppercase; font-size: 14px; }
        .server-info { color: #888; font-size: 11px; font-family: monospace; }
        
        button { 
            cursor: pointer; padding: 4px 10px; background: #333; color: #fff; 
            border: 1px solid #555; border-radius: 4px; font-size: 11px;
        }
        button:hover { background: #00ff88; color: #000; border-color: #00ff88; }
        
        /* LÆ°á»›i Video: Äiá»u chá»‰nh thÃ nh 5 dÃ²ng Ä‘á»ƒ chá»©a Ä‘á»§ 18 kÃªnh */
        #video-grid { 
            flex-grow: 1; display: grid; 
            /* 4 cá»™t, 5 dÃ²ng (Tá»•ng 20 Ã´ -> Ä‘á»§ cho 18 cam) */
            grid-template-columns: repeat(4, 1fr); 
            grid-template-rows: repeat(5, 1fr); 
            gap: 1px; 
            padding: 1px;
        }
        
        .cam-box { 
            position: relative; background: #111; border: 1px solid #222; 
            overflow: hidden; display: flex; align-items: center; justify-content: center;
        }
        
        video { width: 100%; height: 100%; object-fit: contain; }
        
        .label { 
            position: absolute; top: 0; left: 0; 
            background: rgba(0,0,0,0.7); padding: 2px 6px; 
            font-size: 11px; color: #00ff88; z-index: 2; font-weight: bold;
        }
        
        .status-msg { 
            position: absolute; color: #666; font-size: 11px; 
            text-align: center; font-family: monospace;
        }
    </style>
</head>
<body>
    <header>
        <div>
            <span class="brand">TriDuc Media</span>
            <span class="server-info"> | triducmedia.ddns.net:5003</span>
        </div>
        <button onclick="location.reload()">Refresh Signal</button>
    </header>
    
    <div id="video-grid"></div>

    <script>
        // ðŸ‘‡ Cáº¤U HÃŒNH SERVER Má»šI (HTTPS)
        const SERVER_HOST = 'https://triducmedia.ddns.net:5003';
        
        // ðŸ‘‡ Cáº¬P NHáº¬T DANH SÃCH 18 LUá»’NG
        const STREAMS = [
            // NhÃ³m Source (6 kÃªnh)
            'source', 'source1', 'source2', 'source3', 'source4', 'source5',
            // NhÃ³m Studio (2 kÃªnh)
            'studio1', 'studio2',
            // NhÃ³m Laptop (10 kÃªnh)
            'laptop1', 'laptop2', 'laptop3', 'laptop4', 'laptop5', 
            'laptop6', 'laptop7', 'laptop8', 'laptop9', 'laptop10'
        ];

        document.addEventListener("DOMContentLoaded", () => {
            const grid = document.getElementById('video-grid');
            STREAMS.forEach(name => {
                const div = document.createElement('div');
                div.className = 'cam-box';
                div.innerHTML = `
                    <div class="label">${name.toUpperCase()}</div>
                    <div class="status-msg" id="msg-${name}">Connecting...</div>
                    <video id="v-${name}" muted playsinline autoplay></video>
                `;
                grid.appendChild(div);
                load(name);
            });
        });

        function load(name) {
            const video = document.getElementById(`v-${name}`);
            const msgDiv = document.getElementById(`msg-${name}`);
            
            // ÄÆ°á»ng dáº«n HLS chuáº©n
            const url = `${SERVER_HOST}/hls/${name}/index.m3u8`;

            video.onplaying = () => { msgDiv.style.display = 'none'; };
            video.onwaiting = () => { msgDiv.style.display = 'block'; msgDiv.innerText = "Buffering..."; };
            
            video.onerror = () => {
                msgDiv.style.display = 'block';
                msgDiv.innerText = "OFFLINE (404)";
                msgDiv.style.color = "red";
            };

            // 1. Cáº¥u hÃ¬nh cho iPhone/iPad (Native HLS)
            if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
            } 
            // 2. Cáº¥u hÃ¬nh cho PC/Android (Hls.js)
            else if (Hls.isSupported()) {
                const hls = new Hls({
                    capLevelToPlayerSize: true, // Tá»± chá»‰nh Ä‘á»™ phÃ¢n giáº£i cho nháº¹
                    maxBufferLength: 10,        // Buffer ngáº¯n Ä‘á»ƒ giáº£m trá»…
                });
                hls.loadSource(url);
                hls.attachMedia(video);
                
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        // Tá»± Ä‘á»™ng thá»­ káº¿t ná»‘i láº¡i náº¿u rá»›t máº¡ng
                        if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
                            console.log(`Network error on ${name}, retrying...`);
                            hls.startLoad();
                        } else {
                            msgDiv.style.display = 'block';
                            msgDiv.innerText = "Stream Error";
                            hls.destroy();
                        }
                    }
                });
            }
        }
    </script>
</body>

</html>
